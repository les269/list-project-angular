<h2 mat-dialog-title>{{ 'title.databaseEdit' | translate }}</h2>
<mat-dialog-content>
  <div class="database-edit-container">
    <form [formGroup]="form">
      <div class="form-section">
        <!-- Config ID -->
        <div class="form-group">
          <label for="configId"
            >{{ 'disk.configId' | translate }}
            <span class="required">*</span></label
          >
          <input
            id="configId"
            type="text"
            formControlName="configId"
            [placeholder]="'disk.configIdPlaceholder' | translate"
            [disabled]="!data.isAdd" />
          @if (form.get('configId')?.invalid && form.get('configId')?.touched) {
            <span class="error">{{ 'disk.configIdRequired' | translate }}</span>
          }
          @if (
            form.hasError('configIdIsDefault') && form.get('configId')?.touched
          ) {
            <span class="error">{{
              'disk.configIdIsDefault' | translate
            }}</span>
          }
        </div>

        <!-- Config Name -->
        <div class="form-group">
          <label for="configName"
            >{{ 'disk.configName' | translate }}
            <span class="required">*</span></label
          >
          <input
            id="configName"
            type="text"
            formControlName="configName"
            [placeholder]="'disk.configNamePlaceholder' | translate" />
          @if (
            form.get('configName')?.invalid && form.get('configName')?.touched
          ) {
            <span class="error">{{
              'disk.configNameRequired' | translate
            }}</span>
          }
        </div>

        <!-- Database Type -->
        <div class="form-group">
          <label for="databaseType"
            >{{ 'disk.databaseType' | translate }}
            <span class="required">*</span></label
          >
          <select id="databaseType" formControlName="databaseType">
            @for (item of databaseTypes; track $index) {
              <option
                [value]="item"
                [selected]="item === form.get('databaseType')?.value">
                {{ item }}
              </option>
            }
          </select>
          @if (
            form.get('databaseType')?.invalid &&
            form.get('databaseType')?.touched
          ) {
            <span class="error">{{
              'disk.databaseTypeRequired' | translate
            }}</span>
          }
        </div>
        @if (isSqlite) {
          <!-- SQLite 檔案位置 -->
          <div class="form-group">
            <label for="sqliteFilePath"
              >{{ 'disk.sqliteFilePath' | translate }}
              <span class="required">*</span></label
            >
            <input
              id="sqliteFilePath"
              type="text"
              formControlName="sqliteFilePath"
              [placeholder]="'disk.sqliteFilePathPlaceholder' | translate" />
            @if (
              form.hasError('sqlitePathRequired') &&
              form.get('sqliteFilePath')?.touched
            ) {
              <span class="error">{{
                'disk.sqliteFilePathRequired' | translate
              }}</span>
            }
          </div>
        }
      </div>

      <!-- PostgreSQL Specific Fields -->
      @if (isPostgresql) {
        <div class="form-section">
          <h3>{{ 'disk.postgreSQLSetting' | translate }}</h3>

          <!-- Host -->
          <div class="form-group">
            <label for="host"
              >{{ 'disk.host' | translate }}
              <span class="required">*</span></label
            >
            <input
              id="host"
              type="text"
              formControlName="host"
              [placeholder]="'disk.hostPlaceholder' | translate" />
            @if (form.get('host')?.invalid && form.get('host')?.touched) {
              <span class="error">{{ 'disk.hostRequired' | translate }}</span>
            }
          </div>

          <!-- Port -->
          <div class="form-group">
            <label for="port"
              >{{ 'disk.port' | translate }}
              <span class="required">*</span></label
            >
            <input
              id="port"
              type="number"
              formControlName="port"
              [placeholder]="'disk.portPlaceholder' | translate" />
            @if (form.get('port')?.invalid && form.get('port')?.touched) {
              <span class="error">{{ 'disk.portRequired' | translate }}</span>
            }
          </div>

          <!-- Database Name -->
          <div class="form-group">
            <label for="databaseName"
              >{{ 'disk.databaseName' | translate }}
              <span class="required">*</span></label
            >
            <input
              id="databaseName"
              type="text"
              formControlName="databaseName"
              [placeholder]="'disk.databaseNamePlaceholder' | translate" />
            @if (
              form.get('databaseName')?.invalid &&
              form.get('databaseName')?.touched
            ) {
              <span class="error">{{
                'disk.databaseNameRequired' | translate
              }}</span>
            }
          </div>

          <!-- Username -->
          <div class="form-group">
            <label for="username"
              >{{ 'disk.username' | translate }}
              <span class="required">*</span></label
            >
            <input
              id="username"
              type="text"
              formControlName="username"
              [placeholder]="'disk.usernamePlaceholder' | translate" />
            @if (
              form.get('username')?.invalid && form.get('username')?.touched
            ) {
              <span class="error">{{
                'disk.usernameRequired' | translate
              }}</span>
            }
          </div>

          <!-- Password -->
          <div class="form-group">
            <label for="password"
              >{{ 'disk.password' | translate }}
              <span class="required">*</span></label
            >
            <input
              id="password"
              type="password"
              formControlName="password"
              [placeholder]="'disk.passwordPlaceholder' | translate" />
            @if (
              form.get('password')?.invalid && form.get('password')?.touched
            ) {
              <span class="error">{{
                'disk.passwordRequired' | translate
              }}</span>
            }
          </div>

          <!-- Hibernate Dialect -->
          <!-- <div class="form-group">
            <label for="hibernateDialect"
              >Hibernate 方言 <span class="required">*</span></label
            >
            <input
              id="hibernateDialect"
              type="text"
              formControlName="hibernateDialect"
              placeholder="例如: org.hibernate.dialect.PostgreSQLDialect" />
            @if (
              form.get('hibernateDialect')?.invalid &&
              form.get('hibernateDialect')?.touched
            ) {
              <span class="error">Hibernate 方言是必填項</span>
            }
          </div> -->
        </div>
      }

      <!-- Additional Info -->
      <div class="form-section">
        <h3>{{ 'disk.otherInfo' | translate }}</h3>

        <!-- Description -->
        <div class="form-group">
          <label for="description"
            >{{ 'g.description' | translate }}
            <span class="optional"
              >({{ 'g.optional' | translate }})</span
            ></label
          >
          <textarea
            id="description"
            formControlName="description"
            [placeholder]="'disk.descriptionPlaceholder' | translate"
            rows="4"></textarea>
        </div>
      </div>
    </form>
  </div>
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button type="submit" (click)="onSubmit()">
    {{ 'g.save' | translate }}
  </button>
  <button mat-button (click)="testConnection()">
    {{ 'disk.testConnection' | translate }}
  </button>
  <button mat-button mat-dialog-close type="reset">
    {{ 'g.cancel' | translate }}
  </button>
</mat-dialog-actions>
