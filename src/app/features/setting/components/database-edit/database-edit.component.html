<h2 mat-dialog-title>{{ 'title.databaseEdit' | translate }}</h2>
<mat-dialog-content>
  <div class="database-edit-container">
    <form [formGroup]="form">
      <div class="form-section">
        <!-- Config ID -->
        <div class="form-group">
          <label for="configId">設定ID <span class="required">*</span></label>
          <input
            id="configId"
            type="text"
            formControlName="configId"
            placeholder="請輸入設定ID"
            [disabled]="!data.isAdd" />
          @if (form.get('configId')?.invalid && form.get('configId')?.touched) {
            <span class="error">設定ID是必填項</span>
          }
          @if (
            form.hasError('configIdIsDefault') && form.get('configId')?.touched
          ) {
            <span class="error">設定ID不能為 default</span>
          }
        </div>

        <!-- Config Name -->
        <div class="form-group">
          <label for="configName"
            >設定名稱 <span class="required">*</span></label
          >
          <input
            id="configName"
            type="text"
            formControlName="configName"
            placeholder="請輸入設定名稱" />
          @if (
            form.get('configName')?.invalid && form.get('configName')?.touched
          ) {
            <span class="error">設定名稱是必填項</span>
          }
        </div>

        <!-- Database Type -->
        <div class="form-group">
          <label for="databaseType"
            >數據庫類型 <span class="required">*</span></label
          >
          <select id="databaseType" formControlName="databaseType">
            @for (item of databaseTypes; track $index) {
              <option
                [value]="item"
                [selected]="item === form.get('databaseType')?.value">
                {{ item }}
              </option>
            }
          </select>
          @if (
            form.get('databaseType')?.invalid &&
            form.get('databaseType')?.touched
          ) {
            <span class="error">數據庫類型是必填項</span>
          }
        </div>
        @if (isSqlite) {
          <!-- SQLite 檔案位置 -->
          <div class="form-group">
            <label for="sqliteFilePath"
              >SQLite 檔案位置 <span class="required">*</span></label
            >
            <input
              id="sqliteFilePath"
              type="text"
              formControlName="sqliteFilePath"
              placeholder="例如: c:/path/to/database.db" />
            @if (
              form.hasError('sqlitePathRequired') &&
              form.get('sqliteFilePath')?.touched
            ) {
              <span class="error">SQLite 檔案位置是必填項</span>
            }
          </div>
        }
      </div>

      <!-- PostgreSQL Specific Fields -->
      @if (isPostgresql) {
        <div class="form-section">
          <h3>PostgreSQL 設定</h3>

          <!-- Host -->
          <div class="form-group">
            <label for="host">主機地址 <span class="required">*</span></label>
            <input
              id="host"
              type="text"
              formControlName="host"
              placeholder="例如: localhost" />
            @if (form.get('host')?.invalid && form.get('host')?.touched) {
              <span class="error">主機地址是必填項</span>
            }
          </div>

          <!-- Port -->
          <div class="form-group">
            <label for="port">端口 <span class="required">*</span></label>
            <input
              id="port"
              type="number"
              formControlName="port"
              placeholder="例如: 5432" />
            @if (form.get('port')?.invalid && form.get('port')?.touched) {
              <span class="error">端口是必填項</span>
            }
          </div>

          <!-- Database Name -->
          <div class="form-group">
            <label for="databaseName"
              >數據庫名 <span class="required">*</span></label
            >
            <input
              id="databaseName"
              type="text"
              formControlName="databaseName"
              placeholder="請輸入數據庫名" />
            @if (
              form.get('databaseName')?.invalid &&
              form.get('databaseName')?.touched
            ) {
              <span class="error">數據庫名是必填項</span>
            }
          </div>

          <!-- Username -->
          <div class="form-group">
            <label for="username"
              >使用者名稱 <span class="required">*</span></label
            >
            <input
              id="username"
              type="text"
              formControlName="username"
              placeholder="請輸入使用者名稱" />
            @if (
              form.get('username')?.invalid && form.get('username')?.touched
            ) {
              <span class="error"> 使用者名稱是必填項 </span>
            }
          </div>

          <!-- Password -->
          <div class="form-group">
            <label for="password">密碼 <span class="required">*</span></label>
            <input
              id="password"
              type="password"
              formControlName="password"
              placeholder="請輸入密碼" />
            @if (
              form.get('password')?.invalid && form.get('password')?.touched
            ) {
              <span class="error"> 密碼是必填項 </span>
            }
          </div>

          <!-- Hibernate Dialect -->
          <!-- <div class="form-group">
            <label for="hibernateDialect"
              >Hibernate 方言 <span class="required">*</span></label
            >
            <input
              id="hibernateDialect"
              type="text"
              formControlName="hibernateDialect"
              placeholder="例如: org.hibernate.dialect.PostgreSQLDialect" />
            @if (
              form.get('hibernateDialect')?.invalid &&
              form.get('hibernateDialect')?.touched
            ) {
              <span class="error">Hibernate 方言是必填項</span>
            }
          </div> -->
        </div>
      }

      <!-- Additional Info -->
      <div class="form-section">
        <h3>補充信息</h3>

        <!-- Description -->
        <div class="form-group">
          <label for="description"
            >描述 <span class="optional">(可選)</span></label
          >
          <textarea
            id="description"
            formControlName="description"
            placeholder="請輸入設定描述"
            rows="4"></textarea>
        </div>
      </div>
    </form>
  </div>
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button type="submit" (click)="onSubmit()">保存</button>
  <button mat-button (click)="testConnection()">測試連線</button>
  <button mat-button mat-dialog-close type="reset">取消</button>
</mat-dialog-actions>
